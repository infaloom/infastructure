"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1448],{8378:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"k3s/install-k3s","title":"Install K3s","description":"Registry mirroring is enabled because some Hetzner servers are blacklisted. By enabling registry mirroring we","source":"@site/docs/40-k3s/30-install-k3s.md","sourceDirName":"40-k3s","slug":"/k3s/install-k3s","permalink":"/infastructure/k3s/install-k3s","draft":false,"unlisted":false,"editUrl":"https://github.com/infaloom/infastructure/tree/main/docusaurus/docs/40-k3s/30-install-k3s.md","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"Setup Ansible environment","permalink":"/infastructure/k3s/setup-ansible-env"},"next":{"title":"Access the K3s cluster","permalink":"/infastructure/k3s/access-cluster"}}');var i=n(4848),a=n(8453);const t={},l="Install K3s",o={},d=[{value:"Disable ufw on all servers",id:"disable-ufw-on-all-servers",level:2},{value:"Init K3s on the first server",id:"init-k3s-on-the-first-server",level:2},{value:"Add other servers",id:"add-other-servers",level:2},{value:"Add agents",id:"add-agents",level:2},{value:"Add harbor domain to hosts file for internal resolution",id:"add-harbor-domain-to-hosts-file-for-internal-resolution",level:2}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"install-k3s",children:"Install K3s"})}),"\n",(0,i.jsxs)(s.p,{children:["Registry mirroring is enabled because some Hetzner servers are blacklisted. By enabling registry mirroring we\r\nensure that the image is available to the cluster by being able to pull from any of the nodes.\r\n",(0,i.jsx)(s.a,{href:"https://docs.k3s.io/installation/registry-mirror",children:"https://docs.k3s.io/installation/registry-mirror"})]}),"\n",(0,i.jsx)(s.h2,{id:"disable-ufw-on-all-servers",children:"Disable ufw on all servers"}),"\n",(0,i.jsx)(s.p,{children:"This is K3s prerequisite. The servers are not accessible from the internet anyway."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ansible-playbook -i ./ansible/inventory.yaml ./ansible/playbooks/100_disable_ufw.yaml\n"})}),"\n",(0,i.jsx)(s.h2,{id:"init-k3s-on-the-first-server",children:"Init K3s on the first server"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ansible-playbook -i ./ansible/inventory.yaml ./ansible/playbooks/101_k3s_init.yaml\n"})}),"\n",(0,i.jsx)(s.h2,{id:"add-other-servers",children:"Add other servers"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ansible-playbook -i ./ansible/inventory.yaml ./ansible/playbooks/102_k3s_add_servers.yaml\n"})}),"\n",(0,i.jsx)(s.h2,{id:"add-agents",children:"Add agents"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ansible-playbook -i ./ansible/inventory.yaml ./ansible/playbooks/103_k3s_add_agents.yaml\n"})}),"\n",(0,i.jsx)(s.h2,{id:"add-harbor-domain-to-hosts-file-for-internal-resolution",children:"Add harbor domain to hosts file for internal resolution"}),"\n",(0,i.jsxs)(s.p,{children:["This is required for accessing harbor from within the cluster. Ensure that the ",(0,i.jsx)(s.code,{children:"CLUSTER_DOMAIN"})," environment variable is set before running the playbook."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ansible-playbook -i ./ansible/inventory.yaml ./ansible/playbooks/104_add_harbor_to_hosts.yaml\n"})})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>l});var r=n(6540);const i={},a=r.createContext(i);function t(e){const s=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(a.Provider,{value:s},e.children)}}}]);